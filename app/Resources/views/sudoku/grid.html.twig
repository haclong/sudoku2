{% extends 'base.html.twig' %}

{% block body %}
    

<!--form method="post" action="<?php // echo $this->url('home', array('size' => count($grid))) ; ?>"-->
<!--form name="sudokuGrid"-->   
    <button id="getGridButton"   class="btn btn-default" type="submit" name="load" value="get">Charger une grille</button>

    <button class="btn btn-default" type="submit" name="submit" value="start">Résoudre</button>
    <button class="btn btn-default" type="submit" name="submit" value="play">Jouer</button>
    <button id="resetGridButton" class="btn btn-default" type="submit" name="submit" value="reset">Recommencer</button>

    <button id="clearGridButton" class="btn btn-default" type="submit" name="empty" value="clear">Nouvelle grille</button>
    <button id="saveGridButton"  class="btn btn-default" type="submit" name="save" value="save">Enregistrer une nouvelle grille</button>
<p>
    <div>Insérer les chiffres de départ de la grille.</div>
    <div>Cliquer sur 'Résoudre' pour que le robot remplisse la grille seul.</div>
    <div>Cliquer sur 'Jouer' pour résoudre vous meme la grille.</div>
    <div>Cliquer sur 'Recommencer' pour recommencer la grille.</div>
    <div>Cliquer sur 'Nouvelle grille' pour vider la grille complètement.</div>
</p>

<table class="sudoku_grid">
    {% for row in 0..size-1 %}
    <tr>
        {% for col in 0..size-1 %}
            {% set topStyle = "" %}
            {% set leftStyle = "" %}
            {% set sqrt = '9'|sqrt %}
            {% if row % sqrt == 0 %}
                {% set topStyle = " region_border_top" %}
            {% endif %}
            {% if col % sqrt == 0 %}
                {% set leftStyle = " region_border_left" %}
            {% endif %}
            
            <td class="sudoku_case{{topStyle}}{{leftStyle}}"><input type="text" size="1" name="t[{{row}}][{{col}}]" id="t.{{row}}.{{col}}" value=""/></td>
        {% endfor %}
    </tr>
    {% endfor %}
</table>
<!--/form-->
{% endblock %}

{% block javascripts %}

    <script>
        $("#getGridButton").click(function() {
//            alert("getGridButton") ;
//            $.getJSON("{{path('getGrid')}}", refreshGrid); 
            $.ajax({
              dataType: "json",
              url: "{{path('getGrid')}}",
              data: {size: "{{size}}"},
              success: loadGrid
            });
        }) ;

        $("#resetGridButton").click(function() {
            $.ajax({
              dataType: "json",
              url: "{{path('resetGrid')}}",
              success: clearAndLoadGrid
            });
        }) ;


        $("#clearGridButton").click(function() {
            clearGrid() ;
        }) ;

        $("#saveGridButton").click(function() {
//            alert(document.getElementsByTagName("input").length) ;
            var tilesInput = document.getElementsByTagName("input") ;
            var i ;
            var tilesData = new Array() ;
            
            for(i=0; i<tilesInput.length; i++) {
                tilesData[i] = {} ;
                tilesData[i]['id'] = tilesInput[i].id ;
                tilesData[i]['value'] = tilesInput[i].value ;
            }
            
//            alert(JSON.stringify({grid:{size:{{size}},tiles:tilesData}})) ;
            $.ajax({
                type: "POST",
                url: "{{path('saveGrid')}}",
                data: JSON.stringify({grid:{size:"{{size}}",tiles:tilesData}}),
                contentType: 'application/json',
                success: function(data) {alert(data);},
                dataType: "json"
            });
        }) ;

        function loadGrid(data)
        {
//            var myData = JSON.parse(JSON.stringify(data)) ;
            var myData = data.getGrid ;
            var i; 
//            alert(JSON.stringify(myData)) ;
//            alert("Data: " + data.getGrid.size) ;
//            alert("Data: " + myData.tiles.length) ;
            for(i=0; i<myData.tiles.length; i++) {
                document.getElementById(myData.tiles[i].id).value = myData.tiles[i].value;
            }
        }

        function clearGrid()
        {
//            alert(document.getElementsByTagName("input").length) ;
            var tilesInput = document.getElementsByTagName("input") ;
            var i ;

            for(i=0; i<tilesInput.length; i++) {
                tilesInput[i].value = "" ;
            }
        }
        
        function clearAndLoadGrid(data)
        {
            clearGrid() ;
            loadGrid(data) ;
        }
    </script>

{% endblock %}
